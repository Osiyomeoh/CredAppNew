{"ast":null,"code":"var queryString = require('query-string');\nvar setQuery = require('url-set-query');\nvar assign = require('object-assign');\nvar ensureHeader = require('./lib/ensure-header.js');\n\n// this is replaced in the browser\nvar request = require('./lib/request.js');\nvar mimeTypeJson = 'application/json';\nvar noop = function noop() {};\nmodule.exports = xhrRequest;\nfunction xhrRequest(url, opt, cb) {\n  if (!url || typeof url !== 'string') {\n    throw new TypeError('must specify a URL');\n  }\n  if (typeof opt === 'function') {\n    cb = opt;\n    opt = {};\n  }\n  if (cb && typeof cb !== 'function') {\n    throw new TypeError('expected cb to be undefined or a function');\n  }\n  cb = cb || noop;\n  opt = opt || {};\n  var defaultResponse = opt.json ? 'json' : 'text';\n  opt = assign({\n    responseType: defaultResponse\n  }, opt);\n  var headers = opt.headers || {};\n  var method = (opt.method || 'GET').toUpperCase();\n  var query = opt.query;\n  if (query) {\n    if (typeof query !== 'string') {\n      query = queryString.stringify(query);\n    }\n    url = setQuery(url, query);\n  }\n\n  // allow json response\n  if (opt.responseType === 'json') {\n    ensureHeader(headers, 'Accept', mimeTypeJson);\n  }\n\n  // if body content is json\n  if (opt.json && method !== 'GET' && method !== 'HEAD') {\n    ensureHeader(headers, 'Content-Type', mimeTypeJson);\n    opt.body = JSON.stringify(opt.body);\n  }\n  opt.method = method;\n  opt.url = url;\n  opt.headers = headers;\n  delete opt.query;\n  delete opt.json;\n  return request(opt, cb);\n}","map":null,"metadata":{},"sourceType":"script"}